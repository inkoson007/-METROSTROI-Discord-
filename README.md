# Discord DCH Notify
–ê–¥–¥–æ–Ω –¥–ª—è Garry's Mod, –∫–æ—Ç–æ—Ä—ã–π –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Å–∏—Å—Ç–µ–º–æ–π –î–∏—Å–ø–µ—Ç—á–µ—Ä–∞ Metrostroi. –û–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö —Å–∏—Å—Ç–µ–º—ã –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ (–î–¶–•/–î–°–¶–ü) –≤ –≤–∞—à –∫–∞–Ω–∞–ª Discord. –ê–¥–¥–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PHP-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ GMod –≤ Discord.

**–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–π –∞–¥–¥–æ–Ω:** [–ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è Steam::Metrostroi Dispatcher](https://github.com/Alexell/metrostroi_dispatcher)

![Garry's Mod & Discord Logo](https://koffee-project.site/img/koffee-logo.png)

## üìù –û–ø–∏—Å–∞–Ω–∏–µ
–≠—Ç–æ—Ç –∞–¥–¥–æ–Ω –¥–ª—è Garry's Mod –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å Metrostroi –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫–ª—é—á–µ–≤—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö –î–∏—Å–ø–µ—Ç—á–µ—Ä—Å–∫–æ–π –°–∏—Å—Ç–µ–º—ã (–î–¶–•/–î–°–¶–ü) –≤ –≤–∞—à Discord-–∫–∞–Ω–∞–ª. –û–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PHP-–ø—Ä–æ–∫—Å–∏ –¥–ª—è –æ–±—Ö–æ–¥–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –æ—Ç–ø—Ä–∞–≤–∫—É –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ GMod –Ω–∞–ø—Ä—è–º—É—é –≤ Discord.

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
* **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –î–¶–•:** –°–æ–æ–±—â–∞–µ—Ç, –∫–æ–≥–¥–∞ –∏–≥—Ä–æ–∫ –∑–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–∞ –ø–æ—Å—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞ –∏–ª–∏ –ø–æ–∫–∏–¥–∞–µ—Ç –µ–≥–æ.
* **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –î–°–¶–ü:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏ —Å–Ω—è—Ç–∏–∏ –î–°–¶–ü.
* **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å–º–µ–Ω–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞:** –°–æ–æ–±—â–∞–µ—Ç –æ —Å–º–µ–Ω–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ –î–¶–•.

---

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞

–ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö —à–∞–≥–æ–≤: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ PHP-–ø—Ä–æ–∫—Å–∏ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∞–º–æ–≥–æ –∞–¥–¥–æ–Ω–∞ –≤ Garry's Mod.

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PHP-–ø—Ä–æ–∫—Å–∏
1.  –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å –∏–º–µ–Ω–µ–º `webhook_proxy.php` –Ω–∞ –≤–∞—à–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–µ.
2.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª:
    ```php
    <?php
    // === Discord Webhook Proxy ===
    // –ê–≤—Ç–æ—Ä: INK 
    // webhook_proxy.php

    // –£—Å—Ç–∞–Ω–æ–≤–∏ —Å–≤–æ–π Discord Webhook –Ω–∏–∂–µ:
    $discord_webhook_url = "https://–í–ê–®_URL_–í–ï–ë–•–£–ö–ê_DISCORD";

    // –ü–æ–ª—É—á–µ–Ω–∏–µ JSON-–∑–∞–ø—Ä–æ—Å–∞
    $input = file_get_contents('php://input');
    if (!$input) {
        http_response_code(400);
        echo "–ù–µ—Ç –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö";
        exit;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Discord
    $ch = curl_init($discord_webhook_url);
    curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");
    curl_setopt($ch, CURLOPT_POSTFIELDS, $input);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'Content-Type: application/json',
        'Content-Length: ' . strlen($input)
    ]);

    $response = curl_exec($ch);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);

    http_response_code($http_code);
    echo $response;
    ```
3.  **–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `https://–í–ê–®_URL_–í–ï–ë–•–£–ö–ê_DISCORD` –Ω–∞ URL –≤–∞—à–µ–≥–æ Discord-–≤–µ–±—Ö—É–∫–∞. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ª—É—á–∏—Ç—å –µ–≥–æ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Discord-–∫–∞–Ω–∞–ª–∞.
4.  –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ –≤–∞—à –≤–µ–±-—Å–µ—Ä–≤–µ—Ä. –ó–∞–ø–æ–º–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π URL –∫ —ç—Ç–æ–º—É —Ñ–∞–π–ª—É (–Ω–∞–ø—Ä–∏–º–µ—Ä, `http://mywebsite.com/webhook_proxy.php`).

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–¥–¥–æ–Ω–∞ GMod
1.  –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `discord_dhc_notify` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `addons` –≤–∞—à–µ–≥–æ GMod —Å–µ—Ä–≤–µ—Ä–∞.
2.  –í–Ω—É—Ç—Ä–∏ —ç—Ç–æ–π –ø–∞–ø–∫–∏ —Å–æ–∑–¥–∞–π—Ç–µ –µ—â–µ –æ–¥–Ω—É –ø–∞–ø–∫—É `lua`.
3.  –í–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ `lua` —Å–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `autorun`.
4.  –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `discord_dhc_notify.lua` –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ `autorun`. –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –±—É–¥–µ—Ç `addons/discord_dhc_notify/lua/autorun/discord_dhc_notify.lua`.
5.  –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π –∫–æ–¥ –≤ —ç—Ç–æ—Ç —Ñ–∞–π–ª:
    ```lua
    --> Developer By INK <--------------------------------------------------------------------------------

    -- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è --------------------------------------------------------------------------------
    local PROXY_URL = "http://–í–ê–®_–î–û–ú–ï–ù/webhook_proxy.php"
    local LOGGING_ENABLED = true
    local DEFAULT_AVATAR = "https://–í–ê–®_URL" -- –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ 
    local BOT_AVATAR = "https://–í–ê–®_URL" -- –¥–ª—è –∞–≤–∞—Ç–∞—Ä–∞ 

    local function LogMessage(msg)
        if LOGGING_ENABLED then
            print("[–î–¶–• System] " .. msg)
        end
    end
    ---------------------------------------------------------------------------------------------------
    --------------------------------------------------------------------------------
    local function SafeGetNick(ply)
        if IsValid(ply) and ply:IsPlayer() then
            local success, result = pcall(function() return ply:Nick() end)
            if success then return result end
        end
        return "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π"
    end
    --------------------------------------------------------------------------------
    --------------------------------------------------------------------------------
    local function GetPlayerAvatar(ply)
        if not IsValid(ply) or not ply:IsPlayer() then return DEFAULT_AVATAR end
        local steamid64 = ply:SteamID64()
        if not steamid64 then return DEFAULT_AVATAR end
        return "[https://avatars.akamai.steamstatic.com/](https://avatars.akamai.steamstatic.com/)" .. string.sub(steamid64, -2) .. "/" .. steamid64 .. "_full.jpg"
    end
    --------------------------------------------------------------------------------
    --------------------------------------------------------------------------------
    function SendToDiscord(embed, ply)
        if IsValid(ply) and ply:IsPlayer() then
            embed.thumbnail = { url = GetPlayerAvatar(ply) }
        end

        local payload = {
            embeds = {embed},
            username = "–î–¶–• –ú–æ–Ω–∏—Ç–æ—Ä",
            avatar_url = BOT_AVATAR
        }

        local jsonPayload = util.TableToJSON(payload)
        if not jsonPayload then
            LogMessage("–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –≤ JSON")
            return
        end

        HTTP({
            url = PROXY_URL,
            method = "POST",
            headers = {
                ["Content-Type"] = "application/json"
            },
            body = jsonPayload,
            success = function(code, body, headers)
                if code ~= 204 and code ~= 200 then
                    LogMessage("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏: –ö–æ–¥ "..code..". –û—Ç–≤–µ—Ç: "..tostring(body))
                else
                    LogMessage("–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏")
                end
            end,
            failed = function(err)
                LogMessage("–û—à–∏–±–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø—Ä–æ–∫—Å–∏: " .. tostring(err))
            end
        })
    end
    --------------------------------------------------------------------------------
    -- –•—É–∫: –ò–≥—Ä–æ–∫ –∑–∞—Å—Ç—É–ø–∏–ª –Ω–∞ –ø–æ—Å—Ç –î–¶–• --------------------------------------------------------------------------------
    hook.Add("MDispatcher.TookPost", "DiscordNotify_TookPost", function(nick, ply)
        nick = nick or SafeGetNick(ply)
        local embed = {
            title = "üöî –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –ø–æ—Å—Ç –î–¶–•",
            description = "**" .. nick .. "** –∑–∞—Å—Ç—É–ø–∏–ª –Ω–∞ –ø–æ—Å—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞",
            color = 0x3498db,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            footer = { text = "–î–¶–• –°–∏—Å—Ç–µ–º–∞ | " .. os.date("%d.%m.%Y %H:%M") }
        }
        SendToDiscord(embed, ply)
        LogMessage(nick .. " –∑–∞—Å—Ç—É–ø–∏–ª –Ω–∞ –ø–æ—Å—Ç –î–¶–•")
    end)
    --------------------------------------------------------------------------------
    -- –•—É–∫: –ò–≥—Ä–æ–∫ –ø–æ–∫–∏–Ω—É–ª –ø–æ—Å—Ç –î–¶–• --------------------------------------------------------------------------------
    hook.Add("MDispatcher.FreedPost", "DiscordNotify_FreedPost", function(nick, ply)
        nick = nick or SafeGetNick(ply)
        local embed = {
            title = "üöî –û—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Å—Ç–∞ –î–¶–•",
            description = "**" .. nick .. "** –ø–æ–∫–∏–Ω—É–ª –ø–æ—Å—Ç –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞",
            color = 0xe74c3c,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            footer = { text = "–î–¶–• –°–∏—Å—Ç–µ–º–∞ | " .. os.date("%d.%m.%Y %H:%M") }
        }
        SendToDiscord(embed, ply)
        LogMessage(nick .. " –ø–æ–∫–∏–Ω—É–ª –ø–æ—Å—Ç –î–¶–•")
    end)
    --------------------------------------------------------------------------------
    -- –•—É–∫: –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ --------------------------------------------------------------------------------
    hook.Add("MDispatcher.SetInt", "DiscordNotify_SetInt", function(nick, interval, ply)
        nick = nick or SafeGetNick(ply)
        local embed = {
            title = "‚è± –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞",
            description = "**" .. nick .. "** —É—Å—Ç–∞–Ω–æ–≤–∏–ª –∏–Ω—Ç–µ—Ä–≤–∞–ª: **" .. interval .. "**",
            color = 0xf1c40f,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            footer = { text = "–î–¶–• –°–∏—Å—Ç–µ–º–∞ | " .. os.date("%d.%m.%Y %H:%M") }
        }
        SendToDiscord(embed, ply)
        LogMessage(nick .. " –∏–∑–º–µ–Ω–∏–ª –∏–Ω—Ç–µ—Ä–≤–∞–ª –Ω–∞ " .. interval)
    end)
    --------------------------------------------------------------------------------
    -- –•—É–∫: –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –î–°–¶–ü --------------------------------------------------------------------------------
    hook.Add("MDispatcher.DSCPSet", "DiscordNotify_DSCPSet", function(message, ply)
        local embed = {
            title = "üö¶ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –î–°–¶–ü",
            description = message,
            color = 0x2ecc71,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            footer = { text = "–î–¶–• –°–∏—Å—Ç–µ–º–∞ | " .. os.date("%d.%m.%Y %H:%M") }
        }
        SendToDiscord(embed, ply)
        LogMessage("–ù–∞–∑–Ω–∞—á–µ–Ω –î–°–¶–ü: " .. message)
    end)
    --------------------------------------------------------------------------------
    -- –•—É–∫: –°–Ω—è—Ç–∏–µ –î–°–¶–ü --------------------------------------------------------------------------------
    hook.Add("MDispatcher.DSCPUnset", "DiscordNotify_DSCPUnset", function(message, ply)
        local embed = {
            title = "üö¶ –°–Ω—è—Ç–∏–µ –î–°–¶–ü",
            description = message,
            color = 0xe74c3c,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ"),
            footer = { text = "–î–¶–• –°–∏—Å—Ç–µ–º–∞ | " .. os.date("%d.%m.%Y %H:%M") }
        }
        SendToDiscord(embed, ply)
        LogMessage("–°–Ω—è—Ç –î–°–¶–ü: " .. message)
    end)
    --------------------------------------------------------------------------------
    LogMessage("[‚úÖ] -> –°–∏—Å—Ç–µ–º–∞ Discord —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –î–¶–•/–î–°–¶–ü –∑–∞–≥—Ä—É–∂–µ–Ω–∞ V1.3 <-")
    ```
6.  **–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `http://–í–ê–®_–î–û–ú–ï–ù/webhook_proxy.php` –Ω–∞ URL –≤–∞—à–µ–≥–æ PHP-–ø—Ä–æ–∫—Å–∏-—Å–∫—Ä–∏–ø—Ç–∞.
7.  –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–∞—à —Å–µ—Ä–≤–µ—Ä Garry's Mod.
